<style type="text/css">
.removeLink, .duplicateLink .wfPagingButtons, .wForm .actions {font-size:1.3em; width: 100% !important; text-align: center;}
</style>
<script crossorigin="anonymous" integrity="sha256-JAW99MJVpJBGcbzEuXk4Az05s/XyDdBomFqNlM3ic+I=" src="https://code.jquery.com/jquery-3.2.0.min.js"></script>
<script src="https://cdn.elliemae.io/elliemae/core/ssf/1.0/elli.ssf.guest-with-polyfill.js"></script>
<script>

$(document).ready(function(){
   //declares function to replace href in hyperlink text with value of a field in repeat section
  function dynamicLinks(linkClass, fieldId) {
    //creates selector statement with fieldId
    var selection = 'input[id^="' + fieldId + '"]';
    var value = $(selection).val();
    $(linkClass).attr("href", function(i, origLink) {
      return origLink.replace(/!/, value);
    });
     };
  dynamicLinks(".clickableLink","tfa_328");
});



  document.addEventListener("DOMContentLoaded", function(){
  //If loan is already submitted, popup will show up.
    if(document.getElementById("tfa_857").value == "Submitted"){
    wFORMS.behaviors.validation.onFail = null;
    document.getElementById("submit_button").addEventListener("click", alreadySubmitted);
    document.getElementById("submit_button").style.color = "red";
    }
   //If no loan program name, popup will show up.
    else if(document.getElementById("tfa_816").value.length <= 0){
      wFORMS.behaviors.validation.onFail = null;
      document.getElementById("submit_button").addEventListener("click", noLoamProgramName);
      document.getElementById("submit_button").style.color = "red";
      console.log(document.getElementById("tfa_816").value);
    }
     document.getElementById("tfa_859").addEventListener("click", openNewPopup);
  });

function openNewPopup() {
  var guid = document.getElementById('tfa_328').value;
  var link = 'https://2131936492.encompasstpoconnect.com/#/home/pipeline/' + guid +'/documents';
  //var link = 'https://4861819866.encompasstpoconnect.com/#/home/pipeline/' + guid +'/documents';
  window.open(link,'popUpWindow','height=800,width=1200,left=10,top=10,,scrollbars=yes');
}

// function checkPackage() {
//   var tpoAppObject = null;
//   var appraisalCompany = "";
//   var loanObj = {};
//   elli.script.guest.create();
//   //elli.script.subscribe('tpoApplication', 'loanOpen', onLoanOpened);
//   elli.script.getObject("tpoApplication").then(function (tpoAppObject) {
//   this.tpoAppObject = tpoAppObject;
//   console.log('tpoAppObject value ===',tpoAppObject);
//   //GetLoanData();
// });}
// 
// function GetLoanData() {
//   tpoAppObject.getLoanData().then(function (loanData) {
//   console.log('Loan Data ===', loanData);
//   console.log('Inside get loan data function');
// })
// .catch(function (err) {
//   console.log('Fetch Error :-S', err);
// });
// }

function noLoamProgramName() {
  window.alert("You are currently unable to submit because there is no loan program name on file. Please go to product and pricing to register the loan program.");
}

function alreadySubmitted() {
window.alert("The loan has already been submitted.");
}
</script>
